<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <title>ahooks | Gkc's notes</title><meta name="description" content="Record knowledge">
    <link rel="preload" href="/my-notes/assets/style-DUHaMXWK.css" as="style"><link rel="stylesheet" href="/my-notes/assets/style-DUHaMXWK.css">
    <link rel="modulepreload" href="/my-notes/assets/app-CtA61ec0.js"><link rel="modulepreload" href="/my-notes/assets/ahooks.html-ChSPSDgl.js">
    <link rel="prefetch" href="/my-notes/assets/index.html-ipFAqpj6.js" as="script"><link rel="prefetch" href="/my-notes/assets/index.html-GVXXwK1P.js" as="script"><link rel="prefetch" href="/my-notes/assets/aspect-ratio.html-Clk62qne.js" as="script"><link rel="prefetch" href="/my-notes/assets/bfc.html-C0AQH_92.js" as="script"><link rel="prefetch" href="/my-notes/assets/compositing-layer.html-CJd4ht61.js" as="script"><link rel="prefetch" href="/my-notes/assets/knowledge-points.html-eeIXR9-N.js" as="script"><link rel="prefetch" href="/my-notes/assets/pseudo-classes-and-elements.html-DYvGcPj9.js" as="script"><link rel="prefetch" href="/my-notes/assets/skill.html-0RFnwmEm.js" as="script"><link rel="prefetch" href="/my-notes/assets/array.html-CBTuQjO3.js" as="script"><link rel="prefetch" href="/my-notes/assets/complexity-analysis.html-DbuMknEn.js" as="script"><link rel="prefetch" href="/my-notes/assets/linked-list.html-BnzctXsJ.js" as="script"><link rel="prefetch" href="/my-notes/assets/stack.html-CfEzbRSx.js" as="script"><link rel="prefetch" href="/my-notes/assets/functional-programming.html-N-j1Y5v6.js" as="script"><link rel="prefetch" href="/my-notes/assets/interactive.html-CqcVdf51.js" as="script"><link rel="prefetch" href="/my-notes/assets/refactoring.html-DLisCKNg.js" as="script"><link rel="prefetch" href="/my-notes/assets/technical-scheme.html-DAVqwfbo.js" as="script"><link rel="prefetch" href="/my-notes/assets/index.html-BHAhvIMS.js" as="script"><link rel="prefetch" href="/my-notes/assets/index.html-BsICCCW4.js" as="script"><link rel="prefetch" href="/my-notes/assets/basic-command.html-2gNWikgV.js" as="script"><link rel="prefetch" href="/my-notes/assets/commit-amend.html-BNxrMYW5.js" as="script"><link rel="prefetch" href="/my-notes/assets/commit-standard.html-DHymmGac.js" as="script"><link rel="prefetch" href="/my-notes/assets/git-rebase.html-QDKNRsKi.js" as="script"><link rel="prefetch" href="/my-notes/assets/reset-and-revert.html-CtawU7Zf.js" as="script"><link rel="prefetch" href="/my-notes/assets/knowledge-points.html-DQD92EgF.js" as="script"><link rel="prefetch" href="/my-notes/assets/sample-template.html-ATIbb8bK.js" as="script"><link rel="prefetch" href="/my-notes/assets/bit-operation.html-BNAUmsLC.js" as="script"><link rel="prefetch" href="/my-notes/assets/code-snippet.html-BQBWmx_2.js" as="script"><link rel="prefetch" href="/my-notes/assets/code-style.html-DEYm0QgC.js" as="script"><link rel="prefetch" href="/my-notes/assets/cross-domain.html-DDd7DWOw.js" as="script"><link rel="prefetch" href="/my-notes/assets/design-pattern.html-C9RE6rrm.js" as="script"><link rel="prefetch" href="/my-notes/assets/file-operation.html-BRZ0BRWO.js" as="script"><link rel="prefetch" href="/my-notes/assets/handwriting-knowledge.html-BkXRsk49.js" as="script"><link rel="prefetch" href="/my-notes/assets/knowledge-points.html-Bq-iUUkP.js" as="script"><link rel="prefetch" href="/my-notes/assets/performance-optimization.html-Bc6KLPKr.js" as="script"><link rel="prefetch" href="/my-notes/assets/principle-analysis.html-DoZzhFrk.js" as="script"><link rel="prefetch" href="/my-notes/assets/regular-expression.html-jPfWQsMa.js" as="script"><link rel="prefetch" href="/my-notes/assets/algorithm.html-C6omsHZo.js" as="script"><link rel="prefetch" href="/my-notes/assets/character-encoding.html-BSredrld.js" as="script"><link rel="prefetch" href="/my-notes/assets/network.html-DTW1SgvS.js" as="script"><link rel="prefetch" href="/my-notes/assets/index.html-DqmKw5H_.js" as="script"><link rel="prefetch" href="/my-notes/assets/api.html-BOO3Hfqi.js" as="script"><link rel="prefetch" href="/my-notes/assets/code-standard.html-D0wO6ds2.js" as="script"><link rel="prefetch" href="/my-notes/assets/dva.html-CnOEHzsl.js" as="script"><link rel="prefetch" href="/my-notes/assets/react-router.html-DKs9FxEK.js" as="script"><link rel="prefetch" href="/my-notes/assets/redux.html-_4GP1ALl.js" as="script"><link rel="prefetch" href="/my-notes/assets/umijs.html-CvB2llRx.js" as="script"><link rel="prefetch" href="/my-notes/assets/use.html-BVtxr91Y.js" as="script"><link rel="prefetch" href="/my-notes/assets/basic-knowledge.html-C4yL1Zrs.js" as="script"><link rel="prefetch" href="/my-notes/assets/to-use.html-C2g_myRx.js" as="script"><link rel="prefetch" href="/my-notes/assets/index.html-CNejeD2D.js" as="script"><link rel="prefetch" href="/my-notes/assets/keep-alive.html-d0e2Gumn.js" as="script"><link rel="prefetch" href="/my-notes/assets/knowledge-points.html-DtnbvPNU.js" as="script"><link rel="prefetch" href="/my-notes/assets/difference-from-vue2.html-BI4Aw0iA.js" as="script"><link rel="prefetch" href="/my-notes/assets/practice.html-dzaN7wa8.js" as="script"><link rel="prefetch" href="/my-notes/assets/style-guide.html-DR63GSlr.js" as="script"><link rel="prefetch" href="/my-notes/assets/vite.html-AhsAsVDV.js" as="script"><link rel="prefetch" href="/my-notes/assets/principle-analysis.html-DvG5Sbik.js" as="script"><link rel="prefetch" href="/my-notes/assets/develop.html-B_GV5JLK.js" as="script"><link rel="prefetch" href="/my-notes/assets/introduction.html-Bds4kxIl.js" as="script"><link rel="prefetch" href="/my-notes/assets/404.html-z1dv-LzL.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/my-notes/"><img class="logo" src="https://v2.vuepress.vuejs.org/images/hero.png" alt="Gkc&#39;s notes"><span class="site-name can-hide" aria-hidden="true">Gkc&#39;s notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="external-link" href="https://v2.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="VuePress"><!--[--><!--]--> VuePress <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/goodboy-yes/my-node" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="external-link" href="https://v2.vuepress.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="VuePress"><!--[--><!--]--> VuePress <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/goodboy-yes/my-node" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">HTML <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/html/sample-template.html" aria-label="示例模板"><!--[--><!--]--> 示例模板 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/html/knowledge-points.html" aria-label="知识点"><!--[--><!--]--> 知识点 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">JS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/js/knowledge-points.html" aria-label="知识点"><!--[--><!--]--> 知识点 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/handwriting-knowledge.html" aria-label="手写知识点"><!--[--><!--]--> 手写知识点 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/code-snippet.html" aria-label="小技巧"><!--[--><!--]--> 小技巧 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/bit-operation.html" aria-label="位运算"><!--[--><!--]--> 位运算 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/regular-expression.html" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/file-operation.html" aria-label="文件操作"><!--[--><!--]--> 文件操作 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/cross-domain.html" aria-label="跨域"><!--[--><!--]--> 跨域 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/code-style.html" aria-label="代码风格"><!--[--><!--]--> 代码风格 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/performance-optimization.html" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/design-pattern.html" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/js/principle-analysis.html" aria-label="原理分析"><!--[--><!--]--> 原理分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">TypeScript <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/ts/basic-knowledge.html" aria-label="基础知识"><!--[--><!--]--> 基础知识 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/ts/to-use.html" aria-label="如何使用"><!--[--><!--]--> 如何使用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">CSS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/css/knowledge-points.html" aria-label="知识点"><!--[--><!--]--> 知识点 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/css/bfc.html" aria-label="块级格式化上下文(BFC)"><!--[--><!--]--> 块级格式化上下文(BFC) <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/css/pseudo-classes-and-elements.html" aria-label="伪类和伪元素"><!--[--><!--]--> 伪类和伪元素 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/css/aspect-ratio.html" aria-label="aspect-ratio"><!--[--><!--]--> aspect-ratio <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/css/skill.html" aria-label="小技巧"><!--[--><!--]--> 小技巧 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/css/compositing-layer.html" aria-label="合成层"><!--[--><!--]--> 合成层 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Vue2 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/vue2/knowledge-points.html" aria-label="知识点"><!--[--><!--]--> 知识点 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/vue2/keep-alive.html" aria-label="keep-alive"><!--[--><!--]--> keep-alive <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Vue3 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/vue3/difference-from-vue2.html" aria-label="与 Vue2 不同点"><!--[--><!--]--> 与 Vue2 不同点 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/vue3/vite.html" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/vue3/practice.html" aria-label="实践"><!--[--><!--]--> 实践 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/vue3/style-guide.html" aria-label="风格指南"><!--[--><!--]--> 风格指南 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">React <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/react/use.html" aria-label="使用"><!--[--><!--]--> 使用 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/api.html" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/react-router.html" aria-label="react-router(V6)"><!--[--><!--]--> react-router(V6) <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/umijs.html" aria-label="umijs"><!--[--><!--]--> umijs <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/code-standard.html" aria-label="代码规范"><!--[--><!--]--> 代码规范 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/redux.html" aria-label="redux"><!--[--><!--]--> redux <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/react/dva.html" aria-label="dva"><!--[--><!--]--> dva <!--[--><!--]--></a><!----></li><li><a class="route-link route-link-active sidebar-item active" href="/my-notes/react/ahooks.html" aria-label="ahooks"><!--[--><!--]--> ahooks <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/#userequest" aria-label="useRequest"><!--[--><!--]--> useRequest <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/#默认请求" aria-label="默认请求"><!--[--><!--]--> 默认请求 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#手动触发" aria-label="手动触发"><!--[--><!--]--> 手动触发 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#生命周期" aria-label="生命周期"><!--[--><!--]--> 生命周期 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#刷新-重复上一次请求" aria-label="刷新（重复上一次请求）"><!--[--><!--]--> 刷新（重复上一次请求） <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#立即变更数据" aria-label="立即变更数据"><!--[--><!--]--> 立即变更数据 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#取消请求" aria-label="取消请求"><!--[--><!--]--> 取消请求 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#参数管理" aria-label="参数管理"><!--[--><!--]--> 参数管理 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#api" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#loading-delay" aria-label="Loading Delay"><!--[--><!--]--> Loading Delay <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#轮询" aria-label="轮询"><!--[--><!--]--> 轮询 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#ready" aria-label="Ready"><!--[--><!--]--> Ready <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#依赖刷新" aria-label="依赖刷新"><!--[--><!--]--> 依赖刷新 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#屏幕聚焦重新请求" aria-label="屏幕聚焦重新请求"><!--[--><!--]--> 屏幕聚焦重新请求 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#防抖" aria-label="防抖"><!--[--><!--]--> 防抖 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#节流" aria-label="节流"><!--[--><!--]--> 节流 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#缓存-swr" aria-label="缓存 &amp; SWR"><!--[--><!--]--> 缓存 &amp; SWR <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/#错误重试" aria-label="错误重试"><!--[--><!--]--> 错误重试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading" href="/my-notes/node-js.html" aria-label="Nodejs"><!--[--><!--]--> Nodejs <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Git <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/git/basic-command.html" aria-label="用法"><!--[--><!--]--> 用法 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/git/commit-standard.html" aria-label="commit 规范"><!--[--><!--]--> commit 规范 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/git/reset-and-revert.html" aria-label="git reset 和 git revert 的区别"><!--[--><!--]--> git reset 和 git revert 的区别 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/git/commit-amend.html" aria-label="git commit --amend"><!--[--><!--]--> git commit --amend <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/git/git-rebase.html" aria-label="git rebase -i 交互式变基"><!--[--><!--]--> git rebase -i 交互式变基 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Webpack <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/webpack/principle-analysis.html" aria-label="原理分析"><!--[--><!--]--> 原理分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">微信小程序 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/winxin-miniprogram/introduction.html" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/winxin-miniprogram/develop.html" aria-label="开发"><!--[--><!--]--> 开发 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">数据结构与算法 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/dataStructure-algorithms/complexity-analysis.html" aria-label="复杂度分析"><!--[--><!--]--> 复杂度分析 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/dataStructure-algorithms/array.html" aria-label="数组"><!--[--><!--]--> 数组 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/dataStructure-algorithms/linked-list.html" aria-label="链表"><!--[--><!--]--> 链表 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/dataStructure-algorithms/stack.html" aria-label="栈"><!--[--><!--]--> 栈 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">开发实践 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/development-practice/functional-programming.html" aria-label="函数式编程"><!--[--><!--]--> 函数式编程 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/development-practice/refactoring.html" aria-label="重构"><!--[--><!--]--> 重构 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/development-practice/interactive.html" aria-label="交互设计"><!--[--><!--]--> 交互设计 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/development-practice/technical-scheme.html" aria-label="技术方案"><!--[--><!--]--> 技术方案 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">知识点 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/my-notes/knowledge-point/algorithm.html" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/knowledge-point/network.html" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/my-notes/knowledge-point/character-encoding.html" aria-label="字符编码"><!--[--><!--]--> 字符编码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading" href="/my-notes/development-proposals.html" aria-label="发展建议"><!--[--><!--]--> 发展建议 <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item sidebar-heading" href="/my-notes/vs-code.html" aria-label="VSCode"><!--[--><!--]--> VSCode <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item sidebar-heading" href="/my-notes/docker.html" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a><!----></li><li><a class="route-link sidebar-item sidebar-heading" href="/my-notes/collection.html" aria-label="收藏"><!--[--><!--]--> 收藏 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ahooks" tabindex="-1"><a class="header-anchor" href="#ahooks"><span>ahooks</span></a></h1><h2 id="userequest" tabindex="-1"><a class="header-anchor" href="#userequest"><span>useRequest</span></a></h2><p>useRequest 是一个强大的异步数据管理的 Hooks</p><p>目前已有能力包括：</p><ul><li>自动请求/手动请求</li><li>轮询</li><li>防抖</li><li>节流</li><li>屏幕聚焦重新请求</li><li>错误重试</li><li>loading delay</li><li>SWR(stale-while-revalidate)</li><li>缓存</li></ul><h3 id="默认请求" tabindex="-1"><a class="header-anchor" href="#默认请求"><span>默认请求</span></a></h3><p>默认情况下，<code>useRequest</code> 第一个参数是一个异步函数，在组件初始化时，<strong>会自动执行该异步函数</strong>。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="手动触发" tabindex="-1"><a class="header-anchor" href="#手动触发"><span>手动触发</span></a></h3><p>设置了 <code>options.manual = true</code>，则 <code>useRequest</code> 不会默认执行，需要通过 <code>run</code> 或者 <code>runAsync</code> 来触发执行</p><p>run 与 runAsync 的区别在于：</p><ul><li>run 是一个普通的同步函数，我们会自动捕获异常，你可以通过 options.onError 来处理异常时的行为。</li><li>runAsync 是一个返回 Promise 的异步函数，如果使用 runAsync 来调用，则意味着你需要自己捕获异常。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>editUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The username was changed to &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生命周期" tabindex="-1"><a class="header-anchor" href="#生命周期"><span>生命周期</span></a></h3><p><code>useRequest</code> 提供了以下几个生命周期配置项，供你在异步函数的不同阶段做一些处理。</p><ul><li>onBefore：请求之前触发</li><li>onSuccess：请求成功触发</li><li>onError：请求失败触发</li><li>onFinally：请求完成触发</li></ul><h3 id="刷新-重复上一次请求" tabindex="-1"><a class="header-anchor" href="#刷新-重复上一次请求"><span>刷新（重复上一次请求）</span></a></h3><p>useRequest 提供了 <code>refresh</code> 和 <code>refreshAsync</code> 方法，使我们可以使用上一次的参数，重新发起请求。</p><h3 id="立即变更数据" tabindex="-1"><a class="header-anchor" href="#立即变更数据"><span>立即变更数据</span></a></h3><p><code>useRequest</code> 提供了 <code>mutate</code>, 支持立即修改 <code>useRequest</code> 返回的 data 参数。</p><p><code>mutate</code> 的用法与 <code>React.setState</code>一致，支持 <code>mutate(newData)</code> 和 <code>mutate((oldData) =&gt; newData)</code> 两种写法。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> username<span class="token punctuation">,</span> mutate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="取消请求" tabindex="-1"><a class="header-anchor" href="#取消请求"><span>取消请求</span></a></h3><p><code>useRequest</code> 提供了 <code>cancel</code> 函数，可以取消当前正在进行的请求。同时 <code>useRequest</code> 会在以下时机自动取消当前请求：</p><ul><li>组件卸载时，取消正在进行的请求</li><li>竞态取消，当上一次请求还没返回时，又发起了下一次请求，则会取消上一次请求</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">,</span> run<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>editUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The username was changed to &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="参数管理" tabindex="-1"><a class="header-anchor" href="#参数管理"><span>参数管理</span></a></h3><p><code>useRequest</code> 返回的 <code>params</code> 会记录当次调用 <code>service</code> 的参数数组。比如你触发了 <code>run(1, 2, 3)</code>，则 <code>params</code> 等于 <code>[1, 2, 3]</code> 。</p><p>如果我们设置了 <code>options.manual = false</code>，则首次调用 <code>service</code> 的参数可以通过 <code>options.defaultParams</code>来设置。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// get username</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> username<span class="token punctuation">,</span>
  run<span class="token punctuation">,</span>
  params<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">defaultParams</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  data<span class="token operator">?</span><span class="token operator">:</span> TData<span class="token punctuation">,</span>
  error<span class="token operator">?</span><span class="token operator">:</span> Error<span class="token punctuation">,</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> TParams <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params<span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">runAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params<span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token operator">&lt;</span>TData<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">refresh</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">refreshAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token operator">&lt;</span>TData<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mutate</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">?</span><span class="token operator">:</span> TData <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">oldData<span class="token operator">?</span><span class="token operator">:</span> TData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>TData <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> useRequest<span class="token operator">&lt;</span>TData<span class="token punctuation">,</span> TParams<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token function-variable function">service</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token operator">&lt;</span>TData<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    manual<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    defaultParams<span class="token operator">?</span><span class="token operator">:</span> TParams<span class="token punctuation">,</span>
    onBefore<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    onSuccess<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">data</span><span class="token operator">:</span> TData<span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    onError<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Error<span class="token punctuation">,</span> <span class="token literal-property property">params</span><span class="token operator">:</span> TParams</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    onFinally<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> TParams<span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> TData<span class="token punctuation">,</span> e<span class="token operator">?</span><span class="token operator">:</span> Error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="loading-delay" tabindex="-1"><a class="header-anchor" href="#loading-delay"><span>Loading Delay</span></a></h3><p>通过设置 <code>options.loadingDelay</code> ，可以延迟 loading 变成 true 的时间，有效防止闪烁。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">loadingDelay</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="轮询" tabindex="-1"><a class="header-anchor" href="#轮询"><span>轮询</span></a></h3><p>通过设置 <code>options.pollingInterval</code>，进入轮询模式，useRequest 会定时触发 service 执行。</p><p>可以通过 <code>cancel</code> 来停止轮询，通过 <code>run/runAsync</code> 来启动轮询</p><p><code>pollingWhenHidden</code>：在页面隐藏时，是否继续轮询</p><ul><li><code>options.pollingInterval</code>、<code>options.pollingWhenHidden</code> 支持动态变化。</li><li>如果设置 <code>options.manual = true</code>，则初始化不会启动轮询，需要通过 <code>run/runAsync</code> 触发开始。</li><li>轮询原理是在每次请求完成后，等待 <code>pollingInterval</code> 时间，发起下一次请求。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> run<span class="token punctuation">,</span> cancel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">pollingInterval</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ready" tabindex="-1"><a class="header-anchor" href="#ready"><span>Ready</span></a></h3><p><code>useRequest</code> 提供了一个 <code>options.ready</code> 参数，当其值为 false 时，请求永远都不会发出。</p><p>其具体行为如下：</p><ul><li>当 <code>manual=false</code> 自动请求模式时，每次 ready 从 false 变为 true 时，都会自动发起请求，会带上参数 options.defaultParams。</li><li>当 <code>manual=true</code> 手动请求模式时，只要 <code>ready=false</code>，则通过 <code>run/runAsync</code> 触发的请求都不会执行。</li></ul><h3 id="依赖刷新" tabindex="-1"><a class="header-anchor" href="#依赖刷新"><span>依赖刷新</span></a></h3><p><code>useRequest</code> 提供了一个 <code>options.refreshDeps</code> 参数，当它的值变化后，会重新触发请求。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>userId<span class="token punctuation">,</span> setUserId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getUserSchool</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">refreshDeps</span><span class="token operator">:</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="屏幕聚焦重新请求" tabindex="-1"><a class="header-anchor" href="#屏幕聚焦重新请求"><span>屏幕聚焦重新请求</span></a></h3><p>通过设置 <code>options.refreshOnWindowFocus</code>，在浏览器窗口 <code>refocus</code> 和 <code>revisible</code> 时，会重新发起请求。</p><p><code>focusTimespan</code>：重新请求间隔，单位为毫秒</p><p><code>options.refreshOnWindowFocus、options.focusTimespan</code> 支持动态变化。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">refreshOnWindowFocus</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="防抖" tabindex="-1"><a class="header-anchor" href="#防抖"><span>防抖</span></a></h3><p>通过设置 <code>options.debounceWait</code>，进入防抖模式，此时如果频繁触发 <code>run</code> 或者 <code>runAsync</code>，则会以防抖策略进行请求。</p><p>频繁触发 run，只会在最后一次触发结束后执行</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">debounceWait</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="节流" tabindex="-1"><a class="header-anchor" href="#节流"><span>节流</span></a></h3><p>通过设置 <code>options.throttleWait</code>，进入节流模式，此时如果频繁触发 <code>run</code> 或者 <code>runAsync</code>，则会以节流策略进行请求。</p><p>频繁触发 run，只会每隔 300ms 执行一次。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">throttleWait</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="缓存-swr" tabindex="-1"><a class="header-anchor" href="#缓存-swr"><span>缓存 &amp; SWR</span></a></h3><p>如果设置了 <code>options.cacheKey``，useRequest</code> 会将当前请求成功的数据缓存起来。下次组件初始化时，如果有缓存数据，我们会优先返回缓存数据，然后在背后发送新请求，也就是 SWR 的能力。</p><p>你可以通过 <code>options.staleTime</code> 设置数据保持新鲜时间，在该时间内，我们认为数据是新鲜的，不会重新发起请求。</p><p>你也可以通过 <code>options.cacheTime</code> 设置数据缓存时间，超过该时间，我们会清空该条缓存数据。</p><h3 id="错误重试" tabindex="-1"><a class="header-anchor" href="#错误重试"><span>错误重试</span></a></h3><p>通过设置 <code>options.retryCount</code>，指定错误重试次数，则 <code>useRequest</code> 在失败后会进行重试。</p><p><code>cancel</code> 可以取消正在进行的重试行为</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> run <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">retryCount</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: guokc@tsintergy.com">guokc</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav" aria-label="page navigation"><p class="inner"><span class="prev"><a class="route-link" href="/my-notes/react/dva.html" aria-label="dva"><!--[--><!--]--> dva <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/my-notes/assets/app-CtA61ec0.js" defer></script>
  </body>
</html>
