import{_ as p,r as o,o as l,c,a as n,b as s,d as t,e as a}from"./app-CtA61ec0.js";const i="/my-notes/assets/640-DCNSMel9.png",r="/my-notes/assets/640-1656778326309-BEs6tbze.png",u={},d=a(`<h1 id="如何使用" tabindex="-1"><a class="header-anchor" href="#如何使用"><span>如何使用</span></a></h1><h2 id="hello-typescript" tabindex="-1"><a class="header-anchor" href="#hello-typescript"><span>Hello TypeScript</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> typescript
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>以上命令会在全局环境下安装 tsc 命令，安装完成之后，我们就可以在任何地方执行 tsc 命令了。</p><p>我们约定使用 TypeScript 编写的文件以 <code>.ts</code> 为后缀，用 TypeScript 编写 React 时，以 <code>.tsx</code>为后缀。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//hello.ts</span>
<span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>person<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHello</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>tsc hello.ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这时候会生成一个编译好的文件 <code>hello.js</code>：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//hello.js</span>
<span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHello</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用 <code>tsc -w</code>来启用 TypeScript 编译器的观测模式，在检测到文件改动之后，它将重新编译。</p><p>在 TypeScript 中，我们使用 &#39;:&#39; 指定变量的类型，&#39;:&#39; 的前后有没有空格都可以。</p><p>上述例子中，我们用 &#39;:&#39; 指定 person 参数类型为 string。但是编译为 js 之后，并没有什么检查的代码被插入进来。这是因为 <strong>TypeScript 只会在编译时对类型进行静态检查，如果发现有错误，编译的时候就会报错</strong>。而在运行时，与普通的 JavaScript 文件一样，不会对类型进行检查。</p><p><strong>TypeScript 编译的时候即使报错了，还是会生成编译结果</strong>，我们仍然可以使用这个编译之后的文件。如果要在报错的时候终止 js 文件的生成，可以在 <code>tsconfig.json</code> 中配置 <code>noEmitOnError</code> 即可</p><h2 id="tsconfig-json" tabindex="-1"><a class="header-anchor" href="#tsconfig-json"><span>tsconfig.json</span></a></h2><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在项目的根目录下创建一个空 JSON 文件。通过这种方式，TypeScript 将 会把此目录和子目录下的所有 .ts 文件作为编译上下文的一部分，它还会包含一部分默认的编译选项</p><p>可以通过 <code>compilerOptions</code> 来定制你的编译选项</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 基本选项 */</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定 ECMAScript 目标版本: &#39;ES3&#39; (default), &#39;ES5&#39;, &#39;ES6&#39;/&#39;ES2015&#39;, &#39;ES2016&#39;, &#39;ES2017&#39;, or &#39;ESNEXT&#39;</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定使用模块: &#39;commonjs&#39;, &#39;amd&#39;, &#39;system&#39;, &#39;umd&#39; or &#39;es2015&#39;</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 指定要包含在编译中的库文件</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许编译 javascript 文件</span>
    <span class="token property">&quot;checkJs&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 报告 javascript 文件中的错误</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定 jsx 代码的生成: &#39;preserve&#39;, &#39;react-native&#39;, or &#39;react&#39;</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 生成相应的 &#39;.d.ts&#39; 文件</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 生成相应的 &#39;.map&#39; 文件</span>
    <span class="token property">&quot;outFile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 将输出文件合并为一个文件</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定输出目录</span>
    <span class="token property">&quot;rootDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 用来控制输出目录结构 --outDir.</span>
    <span class="token property">&quot;removeComments&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除编译后的所有的注释</span>
    <span class="token property">&quot;noEmit&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 不生成输出文件</span>
    <span class="token property">&quot;importHelpers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 从 tslib 导入辅助工具函数</span>
    <span class="token property">&quot;isolatedModules&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 将每个文件作为单独的模块 （与 &#39;ts.transpileModule&#39; 类似）.</span>

    <span class="token comment">/* 严格的类型检查选项 */</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用所有严格类型检查选项</span>
    <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 在表达式和声明上有隐含的 any类型时报错</span>
    <span class="token property">&quot;strictNullChecks&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用严格的 null 检查</span>
    <span class="token property">&quot;noImplicitThis&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 当 this 表达式值为 any 类型的时候，生成一个错误</span>
    <span class="token property">&quot;alwaysStrict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 以严格模式检查每个模块，并在每个文件里加入 &#39;use strict&#39;</span>

    <span class="token comment">/* 额外的检查 */</span>
    <span class="token property">&quot;noUnusedLocals&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 有未使用的变量时，抛出错误</span>
    <span class="token property">&quot;noUnusedParameters&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 有未使用的参数时，抛出错误</span>
    <span class="token property">&quot;noImplicitReturns&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 并不是所有函数里的代码都有返回值时，抛出错误</span>
    <span class="token property">&quot;noFallthroughCasesInSwitch&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）</span>

    <span class="token comment">/* 模块解析选项 */</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 选择模块解析策略： &#39;node&#39; (Node.js) or &#39;classic&#39; (TypeScript pre-1.6)</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 用于解析非相对模块名称的基目录</span>
    <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 模块名到基于 baseUrl 的路径映射的列表</span>
    <span class="token property">&quot;rootDirs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 根文件夹列表，其组合内容表示项目运行时的结构内容</span>
    <span class="token property">&quot;typeRoots&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 包含类型声明的文件列表</span>
    <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要包含的类型声明文件名列表</span>
    <span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许从没有设置默认导出的模块中默认导入。</span>

    <span class="token comment">/* Source Map Options */</span>
    <span class="token property">&quot;sourceRoot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定调试器应该找到 TypeScript 文件而不是源文件的位置</span>
    <span class="token property">&quot;mapRoot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定调试器应该找到映射文件而不是生成文件的位置</span>
    <span class="token property">&quot;inlineSourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件</span>
    <span class="token property">&quot;inlineSources&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性</span>

    <span class="token comment">/* 其他选项 */</span>
    <span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用装饰器</span>
    <span class="token property">&quot;emitDecoratorMetadata&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 为装饰器提供元数据的支持</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用 include 和 exclude 选项来指定需要包含的文件和排除的文件</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/**/*.spec.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./src/someSubFolder&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用 globs：<code>**/*</code> （一个示例用法：<code>src/**/*</code>）意味着匹配所有的文件夹和所有文件（扩展名为 .ts/.tsx，当开启了 allowJs: true 选项时，扩展名可以是 .js/.jsx）。</p></blockquote>`,22),k={id:"类型声明来源",tabindex:"-1"},m={class:"header-anchor",href:"#类型声明来源"},v={href:"https://mp.weixin.qq.com/s/AsTrGLhipd32RrNUFHuD5A",target:"_blank",rel:"noopener noreferrer"},b=a(`<p>我们平常使用的 HTMLElement、Event 等内置 api 是如何有类型提示的？ts 提供以下几种类型声明的来源</p><h3 id="lib-中内置的类型声明" tabindex="-1"><a class="header-anchor" href="#lib-中内置的类型声明"><span>lib 中内置的类型声明</span></a></h3><p><code>TypeScript</code> 设计了 <code>declare</code> 的语法，可以单独声明变量的类型：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 对象</span>
<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> guang<span class="token operator">:</span> Person<span class="token punctuation">;</span>

<span class="token comment">// 函数</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>num1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> num2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样单独声明了类型，使用这些 api 的时候也就能做类型检查。</p><p>像 JS 引擎那些 api，还有浏览器提供的 api，这些基本是必用的，而且都有标准的。所以 <code>TypeScript</code> 给内置了它们的类型声明，放在了<code>TypeScript</code> 包下的 <code>lib</code> 目录，使用的时候在<code>tsconfig.json</code> 里配置下 <code>compilerOptions.lib</code>，就可以引入对应的 <code>d.ts</code> 的类型声明文件。</p><p><img src="`+i+'" alt=""></p><h3 id="types-xx" tabindex="-1"><a class="header-anchor" href="#types-xx"><span>@types/xx</span></a></h3><p>ts 内置的类型声明只有 dom 和 es ，node 等环境的 api 因为没有标准而没有被 TS 内置，但 TS 同样也支持了这些环境的类型声明的配置。</p><p>方式是通过 <code>@types/xxx</code> 的包，TS 会先加载内置的 lib 的类型声明，然后再去查找 @types 包下的类型声明。这样，其他环境的类型声明就可以通过这种方式来扩展。在<code>tsconfig.json</code> 里配置 <code>compilerOptions.typeRoots</code>，可以修改查找 @types 包的目录</p><p>这种方式也可以给 JS 包加上类型声明，js 包如果本身是 ts 写的，编译的时候就可以开启 <code>compilerOptions.declaration</code>，来生成 <code>d.ts</code> 文件，然后在 <code>package.json</code> 里配置 <code>types</code> 来指定 <code>d.ts</code> 的位置，这样就不需要单独的 <code>@types</code> 包了。但如果代码不是用 ts 写的，那可能就需要单独写一个 <code>@types/xxx</code> 的包来声明 ts 类型</p><h3 id="include-files" tabindex="-1"><a class="header-anchor" href="#include-files"><span>include + files</span></a></h3><p>开发者自己写的类型声明可以通过在<code>tsconfig.json</code> 里配置 <code>include</code>等属性引入</p><p>tsc 在编译的时候，会分别加载 <code>lib</code> 的，<code>@types</code> 下的，还有 <code>include</code> 和 <code>files</code> 的文件，进行类型检查。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>除了在变量声明时定义类型外，TS 也支持通过 <code>declare</code> 单独声明类型。只存放类型声明的文件后缀是 <code>d.ts</code>。</p><p>TypeScript 存放类型声明的地方：</p><ul><li><p><code>lib</code>：内置的类型声明，包含 dom 和 es 的，因为这俩都是有标准的。</p></li><li><p><code>@types/xx</code>：其他环境的 api 类型声明，比如 node，还有 npm 包的类型声明</p></li><li><p>开发者写的代码：通过 include + exclude 还有 files 指定</p></li></ul><p>其中，npm 包也可以同时存放 ts 类型，通过 <code>packages.json</code> 的 <code>types</code> 字段指定路径即可。</p><p>常见的是 vue 的类型是存放在 npm 包下的，而 react 的类型是在 <code>@types/react</code> 里的。因为源码一个是 ts 写的，一个不是。</p>',20),g={id:"类型声明方式",tabindex:"-1"},y={class:"header-anchor",href:"#类型声明方式"},h={href:"https://mp.weixin.qq.com/s/AsTrGLhipd32RrNUFHuD5A",target:"_blank",rel:"noopener noreferrer"},f=a(`<h3 id="namespace" tabindex="-1"><a class="header-anchor" href="#namespace"><span>namespace</span></a></h3><p>TS 最早支持的模块化方案是 <code>namespace</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">namespace</span> Guang <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;guang&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">const</span> guang<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译后的代码</p><p><img src="`+r+`" alt=""></p><h3 id="declare-module" tabindex="-1"><a class="header-anchor" href="#declare-module"><span>declare module</span></a></h3><p>后来出现了 <code>CommonJS</code> 的规范，那种不能叫 <code>namespace</code> 了，所以 TS 支持了 <code>module</code></p><p><code>@types/node</code> 的 api 定义就是一堆的 <code>module</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;fs/promises&#39;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Abortable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;node:events&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Stream <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;node:stream&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>
        Stats<span class="token punctuation">,</span>
        BigIntStats<span class="token punctuation">,</span>
        StatOptions<span class="token punctuation">,</span>
        WriteVResult<span class="token punctuation">,</span>
        ReadVResult<span class="token punctuation">,</span>
        PathLike<span class="token punctuation">,</span>
        RmDirOptions<span class="token punctuation">,</span>
        RmOptions<span class="token punctuation">,</span>
        MakeDirectoryOptions<span class="token punctuation">,</span>
        Dirent<span class="token punctuation">,</span>
        OpenDirOptions<span class="token punctuation">,</span>
        Dir<span class="token punctuation">,</span>
        ObjectEncodingOptions<span class="token punctuation">,</span>
        BufferEncodingOption<span class="token punctuation">,</span>
        OpenMode<span class="token punctuation">,</span>
        Mode<span class="token punctuation">,</span>
        WatchOptions<span class="token punctuation">,</span>
        WatchEventType<span class="token punctuation">,</span>
        CopyOptions<span class="token punctuation">,</span>
        ReadStream<span class="token punctuation">,</span>
        WriteStream<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;node:fs&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">interface</span> <span class="token class-name">FileChangeInfo<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">|</span> Buffer<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
        eventType<span class="token operator">:</span> WatchEventType<span class="token punctuation">;</span>
        filename<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="es-module" tabindex="-1"><a class="header-anchor" href="#es-module"><span>es module</span></a></h3><p>后来 JS 有了 <code>es module</code> 规范，所以现在推荐直接用 <code>import</code> <code>export</code> 的方式来声明模块和导入导出了。</p><p>有了 <code>es module</code> 之后，TS 有了一个单独的设计：<code>d.ts</code> 中，<strong>如果没有 <code>import</code>、<code>export</code> 语法，那所有的类型声明都是全局的，否则是模块内的。</strong></p><p>在模块内如果要定义全局类型，可以使用<code>declare global</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fs <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不止是 <code>es module</code> 的模块里可以用 <code>global</code> 声明全局类型，<code>module</code> 的方式声明的 <code>CommonJS</code> 模块也是可以的</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;buffer&quot;</span> <span class="token punctuation">{</span>
  global <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token class-name">BufferEncoding</span> <span class="token operator">=</span>
      <span class="token operator">|</span> <span class="token string">&quot;ascii&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;utf8&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;utf-8&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;utf16le&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;ucs2&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;ucs-2&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;base64&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;base64url&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;latin1&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;binary&quot;</span>
      <span class="token operator">|</span> <span class="token string">&quot;hex&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当需要引入模块，又想类型声明依然是全局的时，可以使用<code>编译器指令 reference</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// Reference required types from the default lib:</span>
<span class="token comment">/// &lt;reference lib=&quot;es2020&quot; /&gt;</span>
<span class="token comment">/// &lt;reference lib=&quot;esnext.asynciterable&quot; /&gt;</span>
<span class="token comment">/// &lt;reference lib=&quot;esnext.intl&quot; /&gt;</span>
<span class="token comment">/// &lt;reference lib=&quot;esnext.bigint&quot; /&gt;</span>

<span class="token comment">// Base definitions for all NodeJS modules that are not specific to any version of TypeScript:</span>
<span class="token comment">/// &lt;reference path=&quot;assert.d.ts&quot; /&gt;</span>
<span class="token comment">/// &lt;reference path=&quot;assert/strict.d.ts&quot; /&gt;</span>
<span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样既可以引入类型声明，又不会导致所有类型声明都变为模块内的</p><h3 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span>总结</span></a></h3><p>TS 声明模块的方式</p><ul><li><p><code>namespace</code>：最早的实现模块的方式，编译为声明对象和设置对象的属性的 JS 代码，很容易理解</p></li><li><p><code>module</code>：和 namespace 的 AST 没有任何区别，只不过一般用来声明 CommonJS 的模块，在 @types/node 下有很多</p></li><li><p><code>es module</code>：es 标准的模块语法，ts 额外扩展了 import type</p></li></ul><p><code>d.ts</code> 的类型声明默认是全局的，除非有 <code>es module</code> 的 <code>import</code>、<code>export</code> 的声明，这时候就要手动 <code>declare global</code> 了。为了避免这种情况，可以用 <code>reference</code> 的编译器指令。</p><h2 id="模块" tabindex="-1"><a class="header-anchor" href="#模块"><span>模块</span></a></h2><h3 id="模块路径动态查找" tabindex="-1"><a class="header-anchor" href="#模块路径动态查找"><span>模块路径动态查找</span></a></h3><p>当导入路径不是相对路径时，模块解析将会模仿 Node 模块解析策略</p><ul><li><p>当你使用 <code>import \\* as foo from &#39;foo&#39;</code>，将会按如下顺序查找模块：</p><p><code>./node_modules/foo</code></p><p><code>../node_modules/foo</code></p><p>直到系统的根目录</p></li><li><p>当你使用 <code>import \\* as foo from &#39;something/foo&#39;</code>，将会按照如下顺序查找内容</p><p><code>./node_modules/something/foo</code></p><p><code>../node_modules/something/foo</code></p><p>直到系统的根目录</p></li></ul><p>TypeScript 将会检查以下内容</p><ul><li>路径表示一个文件，如：<code>foo.ts</code></li><li>路径是一个文件夹，并且存在一个文件 <code>foo/index.ts</code></li><li>路径是一个文件夹，并且存在一个 <code>package.json</code> 文件，在该文件中指定 <code>types</code> 的文件存在</li><li>路径是一个文件夹，并且存在一个 <code>package.json</code> 文件，在该文件中指定 <code>main</code> 的文件存在</li></ul><p>文件类型是指 .ts，.d.ts 或者 .js</p><h3 id="重写类型的动态查找" tabindex="-1"><a class="header-anchor" href="#重写类型的动态查找"><span>重写类型的动态查找</span></a></h3><p>可以通过 declare module &#39;somePath&#39; 声明一个全局模块的方式，来解决查找模块路径的问题。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// global.d.ts</span>
declare module <span class="token string">&#39;foo&#39;</span> <span class="token punctuation">{</span>
  <span class="token comment">// some variable declarations</span>
  <span class="token keyword">export</span> <span class="token keyword">var</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// anyOtherTsFileInYourProject.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> foo <span class="token keyword">from</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// TypeScript 将假设（在没有做其他查找的情况下）</span>
<span class="token comment">// foo 是 { bar: number }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>在 d.ts 中，使用 declare 与 declare global 两个作用是相等的。那么什么时候使用 declare, 又什么时候使用 declare global？</p><p>在模块文件中定义 declare，如果想要用作全局就可以使用 declare global 完成该需求。</p></blockquote><h2 id="工具类型" tabindex="-1"><a class="header-anchor" href="#工具类型"><span>工具类型</span></a></h2><h3 id="readonly" tabindex="-1"><a class="header-anchor" href="#readonly"><span>Readonly</span></a></h3><p>Readonly 可以将类型转换为只读对象，使用方式是 <code>Readonly&lt;T&gt;</code>。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type Person2 <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token literal-property property">a</span><span class="token operator">:</span> Person2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;wangly19&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token literal-property property">b</span><span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;wangly19&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;wangly19 new&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 报错</span>
b<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;wangly19 new&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="record" tabindex="-1"><a class="header-anchor" href="#record"><span>Record</span></a></h3><p>Record 能够快速创建对象类型。它的使用方式是<code>Record&lt;K, V&gt;</code>，能够快速的为 object 创建统一的 key 和 value 类型。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token literal-property property">test</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//报错：Type &#39;number&#39; is not assignable to type &#39;string&#39;.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pick-omit" tabindex="-1"><a class="header-anchor" href="#pick-omit"><span>Pick &amp; Omit</span></a></h3><p><strong>Pick</strong>：主要作用是从一组属性中拿出某个属性，并将其返回，使用方法是<code>Pick&lt;P, K&gt;</code></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string
  <span class="token literal-property property">age</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
type test <span class="token operator">=</span> Pick<span class="token operator">&lt;</span>Person<span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token operator">&gt;</span> <span class="token comment">// type test = {age: number;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Omit</strong>：主要作用是从一组属性中排除某个属性，并将排除属性后的结果返回。使用方法是<code>Omit&lt;P, K&gt;</code>，与 Pick 的结果是相反的，如果说 Pick 是取出，那么 Omit 则是过滤的效果</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string
  <span class="token literal-property property">age</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
type test <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>Person<span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token operator">&gt;</span> <span class="token comment">// type test = {name: string;}</span>
type test <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>Person<span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token operator">|</span><span class="token string">&#39;name&#39;</span><span class="token operator">&gt;</span> <span class="token comment">// 去除多个</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重写原有字段的类型</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type test <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>Person<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="exclude-extract" tabindex="-1"><a class="header-anchor" href="#exclude-extract"><span>Exclude &amp; Extract</span></a></h3><p><strong>Exclude</strong>：从一个联合类型中排除掉属于另一个联合类型的子集，使用形式是<code>Exclude&lt;T, S&gt;</code>，如果 T 中的属性在 S 不存在那么就会返回。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
type outPut <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span>keyof <span class="token constant">A</span><span class="token punctuation">,</span> keyof <span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token comment">// type outPut = &quot;hidden&quot; | &quot;status&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Extract</strong>：跟 Exclude 相反，从一个联合类型中取出属于另一个联合类型的子集</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">hidden</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
type outPut <span class="token operator">=</span> Extract<span class="token operator">&lt;</span>keyof <span class="token constant">A</span><span class="token punctuation">,</span> keyof <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token comment">// type outPut = &quot;show&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="partial" tabindex="-1"><a class="header-anchor" href="#partial"><span>Partial</span></a></h3><p>Partial 是一个将类型转为可选类型的工具，对于不明确的类型来说，需要将所有的属性转化为可选的?.形式，转换成为可选的属性类型。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string
  <span class="token literal-property property">age</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
type test <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> <span class="token comment">// {name?: string,age?: number}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="required" tabindex="-1"><a class="header-anchor" href="#required"><span>Required</span></a></h3><p>将类型中所有选项变为必选，去除所有？</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string
  age<span class="token operator">?</span><span class="token operator">:</span> number
<span class="token punctuation">}</span>
type test <span class="token operator">=</span> Person<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> <span class="token comment">// {name: string,age: number}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nonnullable" tabindex="-1"><a class="header-anchor" href="#nonnullable"><span>NonNullable</span></a></h3><p><code>NonNullable&lt;Type&gt;</code>会将 <code>null</code>、<code>never </code>和 <code>undefined</code>从 <code>Type</code> 中排除掉，不会剔除 <code>void</code>、<code>unknow</code> 类型，由剩余类型组成一个新的类型</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type <span class="token constant">T01</span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span>string <span class="token operator">|</span> number <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string | number</span>

type <span class="token constant">T02</span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> string<span class="token punctuation">)</span> <span class="token operator">|</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// (() =&gt; string) | string[]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="constructorparameters" tabindex="-1"><a class="header-anchor" href="#constructorparameters"><span>ConstructorParameters</span></a></h3><p>返回 class 中构造函数参数类型组成的 元组类型</p><p>定义</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Obtain the parameters of a constructor function type in a tuple
 */</span>
type ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> infer <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> never<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">weight</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;women&quot;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;women&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

type ConstructorType <span class="token operator">=</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Person<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">//  [name: string, age: number, gender: &quot;man&quot; | &quot;women&quot;]</span>

<span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> ConstructorType <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;man&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="instancetype" tabindex="-1"><a class="header-anchor" href="#instancetype"><span>InstanceType</span></a></h3><p>获取 class 构造函数的返回类型</p><p>定义</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Obtain the return type of a constructor function type
 */</span>
type InstanceType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> infer <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> any<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">weight</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;women&quot;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;women&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> gender<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

type Instance <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Person<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Person</span>

<span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> Instance <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
  <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters"><span>Parameters</span></a></h3><p>获取函数的参数类型组成的元组</p><p>定义</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Obtain the parameters of a function type in a tuple
 */</span>
type Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> infer <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> never<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type <span class="token function-variable function">FunctionType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean<span class="token punctuation">;</span>
type FunctionParamsType <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span>FunctionType<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// [name: string, age: number]</span>
<span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> FunctionParamsType <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="returntype" tabindex="-1"><a class="header-anchor" href="#returntype"><span>ReturnType</span></a></h3><p>获取函数的返回值类型</p><p>定义</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Obtain the return type of a function type
 */</span>
type ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> infer <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> any<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type <span class="token function-variable function">FunctionType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> boolean <span class="token operator">|</span> string<span class="token punctuation">;</span>

type FunctionReturnType <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span>FunctionType<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// boolean | string</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="高级概念" tabindex="-1"><a class="header-anchor" href="#高级概念"><span>高级概念</span></a></h2><h3 id="分发" tabindex="-1"><a class="header-anchor" href="#分发"><span>分发</span></a></h3><p>分发的概念和 <code>Conditional Types</code>（条件类型） 息息相关</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 当泛型 T 满足 string 类型的约束时，它会返回 true ，否则则会返回 false 类型</span>
<span class="token keyword">type</span> <span class="token class-name">isString<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// a 的类型为 true</span>
<span class="token keyword">let</span> a<span class="token operator">:</span> isString<span class="token operator">&lt;</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>条件类型看起来和三元表达式非常相似，甚至你完全可以将它理解成为三元表达式。只不过它接受的是类型以及判断的是类型而已。</p><blockquote><p>需要注意的是条件类型 a extends b ? c : d 仅仅支持在 type 关键字中使用</p></blockquote><p>了解了泛型约束之后，我们在回到所谓分发的概念上来</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">GetSomeType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> someTypeOne<span class="token operator">:</span> GetSomeType<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// someTypeone 类型为 &#39;a&#39;</span>

<span class="token keyword">let</span> someTypeTwo<span class="token operator">:</span> GetSomeType<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// someTypeone 类型为 &#39;b&#39;</span>

<span class="token keyword">let</span> someTypeThree<span class="token operator">:</span> GetSomeType<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// someTypeone 类型为&#39;a&#39;|&#39;b&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分发简单来说就是<strong>分别使用 string 和 number 这两个类型进入 GetSomeType 中进行判断，最终返回两次类型结果组成的联合类型</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 伪代码：GetSomeType&lt;string | number&gt; = GetSomeType&lt;string&gt; | GetSomeType&lt;number&gt;</span>
<span class="token keyword">let</span> <span class="token literal-property property">someTypeThree</span><span class="token operator">:</span> GetSomeType<span class="token operator">&lt;</span>string <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>满足分发的条件:</strong></p><ul><li><p>分发一定是需要产生在 extends 产生的类型条件判断中，并且是前置类型 比如<code>T extends string | number ? &#39;a&#39; : &#39;b&#39;;</code> 产生分发效果的也只有 <code>extends</code> 关键字前的 T 类型，<code>string | number</code> 仅仅代表一种条件判断。</p></li><li><p>分发一定是要满足联合类型，只有联合类型才会产生分发（其他类型无法产生分发的效果，比如 &amp; 交集中等等）</p></li><li><p>分发一定要满足所谓的裸类型中才会产生效果</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 此时的T并不是一个单独的”裸类型“T 而是 [T]</span>
type GetSomeType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">|</span> number <span class="token operator">|</span> <span class="token punctuation">[</span>string<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">?</span> <span class="token string">&#39;a&#39;</span>
<span class="token operator">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 即使我们修改了对应的类型判断，仍然不会产生所谓的分发效果。因为[T]并不是一个裸类型</span>
<span class="token comment">// 只会产生一次判断  [string] | number extends string[]  ? &#39;a&#39; : &#39;b&#39;</span>
<span class="token comment">// someTypeThree 仍然只有 &#39;b&#39; 类型 ，如果进行了分发的话那么应该是 &#39;a&#39; | &#39;b&#39;</span>
<span class="token keyword">let</span> <span class="token literal-property property">someTypeThree</span><span class="token operator">:</span> GetSomeType<span class="token operator">&lt;</span><span class="token punctuation">[</span>string<span class="token punctuation">]</span> <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>分发的作用：</strong></p><p>实现高级内置类型 <code>Exclude</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 当满足条件时会得到 never。never 代表的是一个无法达到的类型，不会产生任何效果</span>
<span class="token keyword">type</span> <span class="token class-name">MyExclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">K</span></span> <span class="token operator">?</span> nerve <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">TypeA</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">ExcludeSymbolType</span> <span class="token operator">=</span> MyExclude<span class="token operator">&lt;</span>TypeA<span class="token punctuation">,</span> <span class="token builtin">symbol</span> <span class="token operator">|</span> <span class="token builtin">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="循环" tabindex="-1"><a class="header-anchor" href="#循环"><span>循环</span></a></h3><p>TypeScript 中同样存在对于类型的循环语法(Mapping Type)，我们可以通过 <code>in</code> 关键字配合联合类型来对于类型进行迭代。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  highSchool<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  university<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// IPropsKey类型为</span>
<span class="token comment">// type IPropsKey = {</span>
<span class="token comment">//  name: boolean;</span>
<span class="token comment">//  age: boolean;</span>
<span class="token comment">//  highSchool: boolean;</span>
<span class="token comment">//  university: boolean;</span>
<span class="token comment">//  }</span>
<span class="token keyword">type</span> <span class="token class-name">IPropsKey</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> IProps<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>循环只能对对象进行一层的转化，并不能递归处理</p><p>我们可以通过条件判断和循环进行结合</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">deepPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> deepPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>循环的作用：</strong></p><p>实现高级内置类型 <code>Partial</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">IInfo</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">MyPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">OptionalInfo</span> <span class="token operator">=</span> MyPartial<span class="token operator">&lt;</span>IInfo<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="协变与逆变" tabindex="-1"><a class="header-anchor" href="#协变与逆变"><span>协变与逆变</span></a></h3><p>在了解协变与逆变之前我们需要知道一个概念——子类型。我们前面提到过 string 可以赋值给 unknown 那么就可以理解为 string 是 unknown 的子类型。正常情况下这个关系即子类型可以赋值给父类型是不会改变的我们称之为<strong>协变</strong>，但是在某种情况下两者会出现颠倒我们称这种关系为<strong>逆变</strong>。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">catBark</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">OrangeCat</span> <span class="token keyword">extends</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 以上从属关系</span>
<span class="token comment">// OrangeCat 是 Cat 的子类型</span>
<span class="token comment">// Cat 是 Animal 的子类型</span>
<span class="token comment">// 同理 OrangeCat 也是 Animal 的子类型</span>

<span class="token keyword">const</span> <span class="token literal-property property">cat</span><span class="token operator">:</span> Cat <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;猫猫&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">catBark</span><span class="token operator">:</span> <span class="token string">&quot;喵~~&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token literal-property property">animal</span><span class="token operator">:</span> Animal <span class="token operator">=</span> cat<span class="token punctuation">;</span> <span class="token comment">// no error</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码因为 Cat 的类型定义中完全包括 Animal 的类型定义，所以 Cat 类型完全是可以赋值给 Animal 类型，这被称为<strong>类型兼容性</strong>。通俗来说也就是多的可以赋值给少的</p><p>再看一种情况，假设我有类型 <code>type FnCat = (value: Cat) =&gt; Cat;</code> 请问下面四个谁是它的子类型，即以下那个类型可以赋值给它。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>type <span class="token function-variable function">FnAnimal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> Animal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Animal<span class="token punctuation">;</span>
type <span class="token function-variable function">FnOrangeCat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> OrangeCat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> OrangeCat<span class="token punctuation">;</span>
type <span class="token function-variable function">FnAnimalOrangeCat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> Animal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> OrangeCat<span class="token punctuation">;</span>
type <span class="token function-variable function">FnOrangeCatAnima</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> OrangeCat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Animal<span class="token punctuation">;</span>

type <span class="token constant">RES1</span> <span class="token operator">=</span> FnAnimal <span class="token keyword">extends</span> <span class="token class-name">FnCat</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
type <span class="token constant">RES2</span> <span class="token operator">=</span> FnOrangeCat <span class="token keyword">extends</span> <span class="token class-name">FnCat</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
type <span class="token constant">RES3</span> <span class="token operator">=</span> FnAnimalOrangeCat <span class="token keyword">extends</span> <span class="token class-name">FnCat</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
type <span class="token constant">RES4</span> <span class="token operator">=</span> FnOrangeCatAnima <span class="token keyword">extends</span> <span class="token class-name">FnCat</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>返回值：</strong> 假设使用了 FnCat 返回值的 cat.catBark 属性，如果返回值是 Animal 则不会有这个属性，会导致调用出错。估计返回值只能是 OrangeCat。</p><p><strong>参数：</strong> 假设传入的函数中使用了 orangeCat.color 但是，对外的类型参数还是 Cat 没有 color 属性，就会导致该函数运行时内部报错。</p><p><strong>故可以得出结论：返回值是协变，入参是逆变。</strong></p><h4 id="逆变" tabindex="-1"><a class="header-anchor" href="#逆变"><span>逆变</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> fn1<span class="token operator">!</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fn2<span class="token operator">!</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

fn1 <span class="token operator">=</span> fn2<span class="token punctuation">;</span> <span class="token comment">// TS Error: 不能将fn2的类型赋值给fn1</span>

fn2 <span class="token operator">=</span> fn1<span class="token punctuation">;</span> <span class="token comment">// 正确，被允许</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>fn1 在执行时仅仅需要两个参数<code>a: string, b: number</code>，显然 fn2 的类型定义中是满足这个条件的（当然它还多传递了第三个参数 <code>c:boolean</code>，在 JS 中对于函数而言调用时的参数个数大于定义时的参数个数是被允许的）。</p><p>就比如上述函数的参数类型赋值就被称为<strong>逆变</strong>，参数少（父）的可以赋给参数多（子）的那一个。看起来和类型兼容性（多的可以赋给少的）相反，但是通过调用的角度来考虑的话恰恰满足多的可以赋给少的兼容性原则。</p><p>再来看一个稍微复杂点的例子来加深所谓逆变的理解:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Son继承了Parent 并且比parent多了一个实例属性 name</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;19Qingfeng&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// GrandSon继承了Son 在Son的基础上额外多了一个age属性</span>
<span class="token keyword">class</span> <span class="token class-name">Grandson</span> <span class="token keyword">extends</span> <span class="token class-name">Son</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 分别创建父子实例</span>
<span class="token keyword">const</span> son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">someThing</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>param<span class="token operator">:</span> Son<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// do some someThing</span>
  <span class="token comment">// 注意：这里调用函数的时候传入的实参是Son</span>
  <span class="token function">cb</span><span class="token punctuation">(</span>Son<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">someThing</span><span class="token punctuation">(</span><span class="token punctuation">(</span>param<span class="token operator">:</span> Grandson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token function">someThing</span><span class="token punctuation">(</span><span class="token punctuation">(</span>param<span class="token operator">:</span> Parent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// correct</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刚才我们提到过函数的参数的方式被称为逆变，所以当我们调用 someThing 时传递的 callback 需要赋给定义 something 函数中的 cb 。</p><p>换句话说类型 <code>(param: Grandson) =&gt; param</code> 需要赋给 <code>cb: (param: Son) =&gt; any</code>，这显然是不被允许的。</p><p>相反，第二个<code>someThing((param: Parent) =&gt; param);</code>相当于函数参数重将 Parent 赋给 Son 将少的赋给多的满足逆变，所以是正确的。</p><p>从另一个角度解释，someThing 会在 cb 函数调用时传入一个 Son 参数的实参。所以当我们传入 <code>someThing((param: Parent) =&gt; param)</code> 时，相当于在 something 函数内部调用 <code>(param: Parent) =&gt; param</code> 时会根据 someThing 中 callback 的定义传入一个 Son 。Son 是 Parent 的子类，涵盖所有 Parent 的公共属性方法，自然也是满足条件的。</p><h4 id="协变" tabindex="-1"><a class="header-anchor" href="#协变"><span>协变</span></a></h4><p>函数类型赋值兼容时函数的返回值就是典型的协变场景</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> fn1<span class="token operator">!</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fn2<span class="token operator">!</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

fn2 <span class="token operator">=</span> fn1<span class="token punctuation">;</span> <span class="token comment">// correct</span>
fn1 <span class="token operator">=</span> fn2<span class="token punctuation">;</span> <span class="token comment">// error: 不可以将 string|number|boolean 赋给 string 类型</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>显然 <code>string | number | boolean</code> 是无法分配给 <code>string</code> 类型的，但是 <code>string</code> 类型是满足 <code>string | number | boolean</code> 其中之一，所以自然可以赋值给 <code>string | number | boolean</code> 组成的联合类型。</p><h3 id="待推断类型-infer" tabindex="-1"><a class="header-anchor" href="#待推断类型-infer"><span>待推断类型 infer</span></a></h3><p><code>infer</code> 代表待推断类型，它的必须和 <code>extends</code> 条件约束类型一起使用。</p><p>在条件类型约束中为我们提供了 <code>infer</code> 关键字来提供实现更多的类型可能，它表示我们可以在条件类型中推断一些暂时无法确定的类型</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Flatten<span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span></span> <span class="token operator">=</span> Type <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> Item<span class="token operator">&gt;</span></span> <span class="token operator">?</span> Item <span class="token operator">:</span> Type<span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">SubType</span> <span class="token operator">=</span> Flatten<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
<span class="token keyword">type</span> <span class="token class-name">SubType</span> <span class="token operator">=</span> Flatten<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string|number</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 <code>Item</code> 取决于传进来的 <code>Type</code>，我们类型定义时并不能立即确定某些类型，而是在使用类型时来根据条件来推断对应的类型。</p><p>因为数组中的元素可能为 <code>string</code> 也可能为 <code>number</code>，自然在使用类型时 <code>infer Item</code> 会将待推断的 Item 推断为 <code>string | number</code> 联合类型。</p><blockquote><p>需要注意的是 <code>infer</code> 关键字类型，必须结合 <code>Conditional Types</code> 条件判断来使用。</p></blockquote><p><strong>infer 的使用：</strong></p><p>在 TS 中存在一个内置类型 <code>Parameters</code> ，它接受传入一个函数类型作为泛型参数并且会返回这个函数所有的参数类型组成的元祖。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 定义函数类型</span>
<span class="token keyword">interface</span> <span class="token class-name">IFn</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">FnParameters</span> <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span>IFn<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// [age: number, name: string]</span>

<span class="token keyword">let</span> a<span class="token operator">:</span> FnParameters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现如下</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">MyParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>
  <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">R</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span>
  <span class="token operator">?</span> <span class="token constant">R</span>
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,147),q={href:"https://juejin.cn/post/7089809919251054628",target:"_blank",rel:"noopener noreferrer"},w=a(`<h2 id="小技巧" tabindex="-1"><a class="header-anchor" href="#小技巧"><span>小技巧</span></a></h2><h3 id="使用模板字符串重映射键名" tabindex="-1"><a class="header-anchor" href="#使用模板字符串重映射键名"><span>使用模板字符串重映射键名</span></a></h3><p>当我们期望复制一个接口，并让生成接口在键名上做变更时，我们可以基于模板字面量类型修改键名。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Raw</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  result<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Processor<span class="token operator">&lt;</span><span class="token constant">R</span> <span class="token keyword">extends</span> Raw<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">R</span> <span class="token keyword">as</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">processed</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>Capitalize<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token constant">K</span><span class="token operator">&gt;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">R</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Processed</span> <span class="token operator">=</span> Processor<span class="token operator">&lt;</span>Raw<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Tmp</span> <span class="token punctuation">{</span>
  processedType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  processedContent<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  processedResult<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用映射类型-keyof-对索引类型做变换" tabindex="-1"><a class="header-anchor" href="#使用映射类型-keyof-对索引类型做变换"><span>使用映射类型（keyof）对索引类型做变换</span></a></h3><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">SplitObj<span class="token operator">&lt;</span>Obj<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Key <span class="token keyword">in</span> <span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>Key2 <span class="token keyword">in</span> Key<span class="token punctuation">]</span><span class="token operator">:</span> Obj<span class="token punctuation">[</span>Key2<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Obj</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// type res = {name:string}|{age:number}|{height:number}</span>
<span class="token keyword">type</span> <span class="token class-name">splitobj<span class="token operator">&lt;</span>Obj<span class="token operator">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-extends-做类型判断" tabindex="-1"><a class="header-anchor" href="#使用-extends-做类型判断"><span>使用 extends 做类型判断</span></a></h3><p><code>Key extends string</code> 可判断 key 是否是 string 类型</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">DFS</span><span class="token operator">&lt;</span>Obj<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Key <span class="token keyword">in</span> <span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token operator">:</span> Key <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span>
    <span class="token operator">?</span> Obj<span class="token punctuation">[</span>Key<span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span>
      <span class="token operator">?</span> Key <span class="token operator">|</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>Key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">DFS</span><span class="token operator">&lt;</span>Obj<span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
      <span class="token operator">:</span> Key
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Template</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  aaa<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  bbb<span class="token operator">:</span> <span class="token punctuation">{</span>
    cc<span class="token operator">:</span> <span class="token punctuation">{</span>
      dd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  eee<span class="token operator">:</span> <span class="token punctuation">{</span>
    ff<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    gg<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;aaa&quot; | &quot;bbb&quot; | &quot;eee&quot; | &quot;bbb.cc&quot; | &quot;bbb.cc.dd&quot; | &quot;eee.ff&quot;| &quot;eee.gg&quot;</span>
<span class="token keyword">type</span> <span class="token class-name">res</span> <span class="token operator">=</span> <span class="token constant">DFS</span><span class="token operator">&lt;</span>Template<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9);function x(j,T){const e=o("ExternalLinkIcon");return l(),c("div",null,[d,n("h2",k,[n("a",m,[n("span",null,[n("a",v,[s("类型声明来源"),t(e)])])])]),b,n("h2",g,[n("a",y,[n("span",null,[n("a",h,[s("类型声明方式"),t(e)])])])]),f,n("blockquote",null,[n("p",null,[s("参考链接： "),n("a",q,[s("如何进阶 TypeScript 功底？一文带你理解 TS 中各种高级语法"),t(e)])])]),w])}const P=p(u,[["render",x],["__file","to-use.html.vue"]]),O=JSON.parse('{"path":"/ts/to-use.html","title":"如何使用","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Hello TypeScript","slug":"hello-typescript","link":"#hello-typescript","children":[]},{"level":2,"title":"tsconfig.json","slug":"tsconfig-json","link":"#tsconfig-json","children":[]},{"level":2,"title":"类型声明来源","slug":"类型声明来源","link":"#类型声明来源","children":[{"level":3,"title":"lib 中内置的类型声明","slug":"lib-中内置的类型声明","link":"#lib-中内置的类型声明","children":[]},{"level":3,"title":"@types/xx","slug":"types-xx","link":"#types-xx","children":[]},{"level":3,"title":"include + files","slug":"include-files","link":"#include-files","children":[]},{"level":3,"title":"总结","slug":"总结","link":"#总结","children":[]}]},{"level":2,"title":"类型声明方式","slug":"类型声明方式","link":"#类型声明方式","children":[{"level":3,"title":"namespace","slug":"namespace","link":"#namespace","children":[]},{"level":3,"title":"declare module","slug":"declare-module","link":"#declare-module","children":[]},{"level":3,"title":"es module","slug":"es-module","link":"#es-module","children":[]},{"level":3,"title":"总结","slug":"总结-1","link":"#总结-1","children":[]}]},{"level":2,"title":"模块","slug":"模块","link":"#模块","children":[{"level":3,"title":"模块路径动态查找","slug":"模块路径动态查找","link":"#模块路径动态查找","children":[]},{"level":3,"title":"重写类型的动态查找","slug":"重写类型的动态查找","link":"#重写类型的动态查找","children":[]}]},{"level":2,"title":"工具类型","slug":"工具类型","link":"#工具类型","children":[{"level":3,"title":"Readonly","slug":"readonly","link":"#readonly","children":[]},{"level":3,"title":"Record","slug":"record","link":"#record","children":[]},{"level":3,"title":"Pick & Omit","slug":"pick-omit","link":"#pick-omit","children":[]},{"level":3,"title":"Exclude & Extract","slug":"exclude-extract","link":"#exclude-extract","children":[]},{"level":3,"title":"Partial","slug":"partial","link":"#partial","children":[]},{"level":3,"title":"Required","slug":"required","link":"#required","children":[]},{"level":3,"title":"NonNullable","slug":"nonnullable","link":"#nonnullable","children":[]},{"level":3,"title":"ConstructorParameters","slug":"constructorparameters","link":"#constructorparameters","children":[]},{"level":3,"title":"InstanceType","slug":"instancetype","link":"#instancetype","children":[]},{"level":3,"title":"Parameters","slug":"parameters","link":"#parameters","children":[]},{"level":3,"title":"ReturnType","slug":"returntype","link":"#returntype","children":[]}]},{"level":2,"title":"高级概念","slug":"高级概念","link":"#高级概念","children":[{"level":3,"title":"分发","slug":"分发","link":"#分发","children":[]},{"level":3,"title":"循环","slug":"循环","link":"#循环","children":[]},{"level":3,"title":"协变与逆变","slug":"协变与逆变","link":"#协变与逆变","children":[]},{"level":3,"title":"待推断类型 infer","slug":"待推断类型-infer","link":"#待推断类型-infer","children":[]}]},{"level":2,"title":"小技巧","slug":"小技巧","link":"#小技巧","children":[{"level":3,"title":"使用模板字符串重映射键名","slug":"使用模板字符串重映射键名","link":"#使用模板字符串重映射键名","children":[]},{"level":3,"title":"使用映射类型（keyof）对索引类型做变换","slug":"使用映射类型-keyof-对索引类型做变换","link":"#使用映射类型-keyof-对索引类型做变换","children":[]},{"level":3,"title":"使用 extends 做类型判断","slug":"使用-extends-做类型判断","link":"#使用-extends-做类型判断","children":[]}]}],"git":{"updatedTime":1708503944000,"contributors":[{"name":"guokc","email":"guokc@tsintergy.com","commits":1}]},"filePathRelative":"ts/to-use.md"}');export{P as comp,O as data};
